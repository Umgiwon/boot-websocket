<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Door ID 설정 - 관리자 비밀번호</title>
</head>
<body>
    <h2>비밀번호 입력</h2>
    <p>관리자 전용 비밀번호를 입력해주세요.</p>

    <input type="password" id="adminPassword" placeholder="비밀번호를 입력하세요">
    <button id="nextBtn">다음</button>

    <!-- 간단한 에러 팝업 -->
    <div id="errorBox" style="display:none; color:red; margin-top: 8px;">
        관리자 인증 실패: 비밀번호가 올바르지 않습니다.
    </div>

    <script>
        const nextBtn = document.getElementById("nextBtn");
        const passwordInput = document.getElementById("adminPassword");
        const errorBox = document.getElementById("errorBox");

        nextBtn.addEventListener("click", async function () {
            const password = passwordInput.value.trim();
            if (!password) {
                errorBox.textContent = "비밀번호를 입력해주세요.";
                errorBox.style.display = "block";
                return;
            }

            try {
                // 비밀번호 검증
                const response = await fetch("/api/admin/verify-password", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({password: password})
                });

                if (response.ok) { // 인증 성공
                    // Device ID 입력 화면으로 이동
                    window.location.href = "/setup/device-id";
                } else { // 인증 실패
                    // 에러 메시지 표시
                    errorBox.textContent = "관리자 인증 실패: 비밀번호가 올바르지 않습니다.";
                    errorBox.style.display = "block";
                    passwordInput.value = "";
                    passwordInput.focus();
                }
            } catch (e) {
                console.error(e);
                errorBox.textContent = "서버와의 통신 중 오류가 발생했습니다.";
                errorBox.style.display = "block";
            }
        });
    </script>
</body>
</html>
